{% extends 'base.html' %}

{% block header %}
  <h1>{% block title %}Departures{% endblock %}</h1>
  <h2>Vaihingen Bahnhof</h2>
{% endblock %}

{% block content %}
<div id="departure_tables">
    {% with table_id="R" %}
        {% include 'departure_table.html' %} 
    {% endwith %}
    {% with table_id="H" %}
        {% include 'departure_table.html' %} 
    {% endwith %}
</div>
{% endblock %}

{% block script %}
    <script>
        async function fetchDepartures() {
            const table_ids = ["R", "H"];
            
            for (const id of table_ids) {
                let departure_table_url = (
                    // Get the URL for the departure table and pass the table_id as a query parameter
                    // The URL is generated by the Flask route 'departure.departure_table' (including the blueprint name)
                    {{ url_for('departure.departure_table')|tojson }} + "?" + 
                    new URLSearchParams({ table_id: `${id}` }).toString()
                );

                let departure_table_div = document.getElementById(`departureTable${id}`);

                await fetch(departure_table_url)
                    .then(response => response.text())
                    .then(text => departure_table_div.innerHTML = text);
            }
        }

        // Fetch data every 2 minutes
        setInterval(fetchDepartures, 120000);
        
        // Initial fetch
        fetchDepartures();
    </script>
{% endblock %}
